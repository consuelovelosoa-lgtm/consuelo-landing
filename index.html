<!doctype html>
<html lang="es">
<head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-42YTPKHN4N"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-42YTPKHN4N', { 'debug_mode': true });
</script>
  <!-- Meta Pixel Code -->
<script>
!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}(window, document,'script',
'https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '1327183675569062'); // ‚Üê tu Pixel ID
fbq('track', 'PageView');
</script>
<noscript>
  <img height="1" width="1" style="display:none"
       src="https://www.facebook.com/tr?id=1327183675569062&ev=PageView&noscript=1"/>
</noscript>
<!-- End Meta Pixel Code -->
<link rel="canonical" href="https://veloso56.cl/">
<meta name="robots" content="index, follow">
<!-- Twitter Cards -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@velosodiputada">
<meta name="twitter:title" content="Consuelo Veloso ‚Äî La Defensora del Maule Sur">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Consuelo Veloso √Åvila - Diputada Maule Sur | Elecciones 2025</title>
  <meta name="description" content="Campa√±a ciudadana en el Maule Sur: voz incondicional, dignidad para nuestra tierra y valent√≠a contra los poderosos. S√∫mate como voluntario/a.">
  <meta property="og:title" content="Consuelo Veloso ‚Äî La Defensora Feroz del Maule Sur">
  <meta property="og:description" content="Campa√±a ciudadana en el Maule Sur. S√∫mate.">
  <meta property="og:type" content="website">
  <meta property="og:image" content="https://www.septimapaginanoticias.cl/uploads/images/2025/05/image_750x_68399a9223cc3.jpg">
  <!-- SEO Mejorado -->
<meta name="author" content="Consuelo Veloso √Åvila">
<meta name="keywords" content="Consuelo Veloso, Diputada Maule, Cauquenes, Linares, Parral, San Javier, Elecciones 2025, Maule Sur, Distrito 18">

<!-- Structured Data -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Person",
  "name": "Consuelo Veloso √Åvila",
  "alternateName": "Consuelo Veloso",
  "jobTitle": "Diputada de la Rep√∫blica de Chile",
  "description": "Diputada por el Distrito 18, Regi√≥n del Maule (2022-2026). Candidata a la reelecci√≥n 2025.",
  "url": "https://veloso56.cl",
  "image": "https://veloso56.cl/hero.webp",
  "address": {
    "@type": "PostalAddress",
    "addressRegion": "Regi√≥n del Maule",
    "addressCountry": "CL"
  },
  "memberOf": {
    "@type": "Organization",
    "name": "C√°mara de Diputados de Chile"
  },
  "sameAs": [
    "https://www.instagram.com/consuelovelosodiputada/",
    "https://web.facebook.com/ConsueloVelosoAvila",
    "https://x.com/velosodiputada",
    "https://www.youtube.com/@diputadaconsueloveloso",
    "https://www.tiktok.com/@consuelovelosoavila"
  ]
}
</script>
  <link rel="icon" href="logo-56.png">
  <link rel="apple-touch-icon" href="logo-56.png">
  <meta name="theme-color" content="#e11d48">
  <link rel="preconnect" href="https://www.septimapaginanoticias.cl" crossorigin>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
<!-- ENCUESTA R√ÅPIDA - C√ìDIGO PARA AGREGAR AL INDEX.HTML -->

<!-- 1. Agregar JUSTO DESPU√âS de <body> en index.html -->

<!-- Modal de Encuesta -->
<div id="encuesta-modal" class="encuesta-modal">
  <div class="encuesta-contenido">
    <button class="encuesta-cerrar" onclick="cerrarEncuesta()">&times;</button>
    
    <div id="encuesta-pregunta">
      <h3 style="margin:0 0 16px;color:#e11d48;font-size:20px">üìä Encuesta R√°pida</h3>
      <p style="margin:0 0 20px;font-size:16px;font-weight:600">
        ¬øCu√°l es el tema M√ÅS importante para ti en esta elecci√≥n?
      </p>
      
      <div class="encuesta-opciones">
        <button class="encuesta-btn" onclick="votar('agua-campo')">
          üíß Agua y apoyo al campo
        </button>
        <button class="encuesta-btn" onclick="votar('seguridad')">
          üõ°Ô∏è Seguridad y cuidados
        </button>
        <button class="encuesta-btn" onclick="votar('empleo-jovenes')">
          üéì Empleo para j√≥venes
        </button>
        <button class="encuesta-btn" onclick="votar('salud')">
          üè• Mejor salud p√∫blica
        </button>
        <button class="encuesta-btn" onclick="votar('educacion')">
          üìö Educaci√≥n de calidad
        </button>
      </div>
    </div>
    
    <div id="encuesta-resultados" style="display:none">
      <h3 style="margin:0 0 16px;color:#e11d48;font-size:20px">¬°Gracias por votar! üôå</h3>
      <p style="margin:0 0 20px">Estos son los resultados hasta ahora:</p>
      
      <div id="resultados-barras"></div>
      
      <p style="margin-top:20px;font-size:14px;color:#666">
        <strong id="total-votos">0</strong> personas han votado
      </p>
      
      <button class="btn primary" onclick="cerrarEncuesta()" style="margin-top:12px">
        Continuar al sitio ‚Üí
      </button>
      <button class="btn outline" id="btn-share" type="button" style="margin-top:12px">Compartir resultados</button>
    </div>
  </div>
</div>

<style>
/* Estilos de la encuesta */
.encuesta-modal {
  display: none;
  position: fixed;
  z-index: 9999;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0,0,0,0.7);
  animation: fadeIn 0.3s;
}

.encuesta-modal.show {
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 20px;
}

.encuesta-contenido {
  background: white;
  padding: 32px;
  border-radius: 20px;
  max-width: 500px;
  width: 100%;
  position: relative;
  box-shadow: 0 10px 40px rgba(0,0,0,0.3);
  animation: slideUp 0.3s;
}

.encuesta-cerrar {
  position: absolute;
  right: 16px;
  top: 16px;
  background: none;
  border: none;
  font-size: 32px;
  color: #999;
  cursor: pointer;
  line-height: 1;
  padding: 0;
  width: 32px;
  height: 32px;
}

.encuesta-cerrar:hover {
  color: #e11d48;
}

.encuesta-opciones {
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.encuesta-btn {
  background: white;
  border: 2px solid #e5e5e5;
  padding: 16px 20px;
  border-radius: 12px;
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s;
  text-align: left;
}

.encuesta-btn:hover {
  border-color: #e11d48;
  background: #fef2f2;
  transform: translateX(4px);
}

.resultado-barra {
  margin-bottom: 14px;
}

.resultado-label {
  display: flex;
  justify-content: space-between;
  margin-bottom: 6px;
  font-size: 14px;
  font-weight: 600;
}

.resultado-track {
  height: 32px;
  background: #f3f4f6;
  border-radius: 8px;
  overflow: hidden;
  position: relative;
}

.resultado-fill {
  height: 100%;
  background: linear-gradient(90deg, #e11d48, #f43f5e);
  border-radius: 8px;
  transition: width 0.5s ease;
  display: flex;
  align-items: center;
  justify-content: flex-end;
  padding-right: 12px;
  color: white;
  font-weight: 700;
  font-size: 14px;
  min-width: 40px;
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

@keyframes slideUp {
  from { 
    opacity: 0;
    transform: translateY(30px);
  }
  to { 
    opacity: 1;
    transform: translateY(0);
  }
}

@media (max-width: 600px) {
  .encuesta-contenido {
    padding: 24px;
  }
  
  .encuesta-btn {
    padding: 14px 16px;
    font-size: 15px;
  }
}
</style>

  <script>
/* Reemplazo del script de la encuesta (conecta el modal a tu Apps Script)
   No toques API_URL/SECRET aqu√≠: ya est√°n en script.js.  */

/* 1) Mapa id -> texto visible (para mostrar en resultados) */
const LABELS_ENCUESTA = {
  'agua-campo': 'üíß Agua y apoyo al campo',
  'seguridad': 'üõ°Ô∏è Seguridad y cuidados',
  'empleo-jovenes': 'üéì Empleo para j√≥venes',
  'salud': 'üè• Mejor salud p√∫blica',
  'educacion': 'üìö Educaci√≥n de calidad'
};

/* 2) Llamado por los botones del modal: onclick="votar('agua-campo')"  */
window.votar = async function(optionId){
  const optionText = LABELS_ENCUESTA[optionId] || optionId;

  // Deshabilita botones para evitar doble click
  document.querySelectorAll('.encuesta-btn').forEach(btn => {
    btn.disabled = true; btn.style.opacity = '0.6';
  });

  try{
    // Usa el backend real definido en script.js (sendVote)
    await sendVote(optionId, optionText);

    // Cambia a la vista de resultados del modal
    const pregunta = document.getElementById('encuesta-pregunta');
    const resultados = document.getElementById('encuesta-resultados');
    if (pregunta)   pregunta.style.display = 'none';
    if (resultados) resultados.style.display = 'block';
  }catch(e){
    console.error(e);
    alert('No pudimos registrar tu voto. Intenta de nuevo.');
  }finally{
    document.querySelectorAll('.encuesta-btn').forEach(btn => {
      btn.disabled = false; btn.style.opacity = '';
    });
  }
};

/* 3) Abrir/cerrar el modal */
function mostrarEncuesta(){
  // Si ya vot√≥ en esta encuesta, no mostramos de nuevo
  try{
    if (localStorage.getItem(`voted_${SURVEY_ID}`)) return;
  }catch(_){}
  document.getElementById('encuesta-modal')?.classList.add('show');
}
window.cerrarEncuesta = function(){
  document.getElementById('encuesta-modal')?.classList.remove('show');
};

/* Mostrar a los 2s de cargar */
window.addEventListener('load', () => setTimeout(mostrarEncuesta, 2000));

/* Cerrar con ESC y clic fuera */
document.addEventListener('keydown', e => { if (e.key === 'Escape') cerrarEncuesta(); });
document.getElementById('encuesta-modal')?.addEventListener('click', e => {
  if (e.target.id === 'encuesta-modal') cerrarEncuesta();
});
</script>


<header class="header">
  <div class="container header-inner">
    <div class="brand">
      <img src="logo-56.png" alt="+56" class="brand-logo">
      <span class="brand-name">Consuelo Veloso √Åvila</span>
    </div>

    <!-- Drawer / barra de navegaci√≥n -->
    <nav id="site-nav" class="nav" aria-hidden="true">
      <a href="#inicio" class="active">Inicio</a>
      <a href="#sumate">S√∫mate</a>
      <a href="noticias.html">Noticias</a>
      <a class="btn whatsapp" href="https://chat.whatsapp.com/LDShAeDdPcbHXeD8Y8cQFF" target="_blank" rel="noopener noreferrer">WhatsApp</a>
    </nav>

    <!-- Bot√≥n que abre/cierra el drawer en m√≥vil -->
    <button class="menu btn ghost" aria-label="Abrir men√∫" aria-controls="site-nav" aria-expanded="false">Men√∫</button>
  </div>
</header>

<main id="inicio">
  <!-- HERO -->
  <section class="hero" role="region" aria-labelledby="hero-title">
    <div class="inner container">
      <h1 id="hero-title">Consuelo Veloso</h1>
      <p class="lead">La Defensora Feroz del Maule Sur.</p>
      <p class="lead" style="max-width:720px;margin-top:10px">
        Amor por nuestra gente. Rabia contra la injusticia. Una campa√±a desde el territorio y para el territorio.
      </p>
      <div style="margin-top:18px;display:flex;gap:10px;justify-content:center;flex-wrap:wrap">
        <a class="btn primary" href="#sumate">S√∫mate como voluntario/a ‚Üí</a>
        <a class="btn outline" href="#videos">Ver videos</a>
        <a class="btn whatsapp" href="https://chat.whatsapp.com/LDShAeDdPcbHXeD8Y8cQFF" target="_blank" rel="noopener noreferrer">√önete al WhatsApp</a>
      </div>
    </div>
  </section>

  <!-- BIO -->
  <section class="section" aria-labelledby="bio-title">
    <div class="container grid grid-2">
      <div>
        <h2 id="bio-title" class="h2">¬øQui√©n es Consuelo?</h2>
        <p class="muted">Soy Consuelo, vecina del Maule Sur. Crec√≠ viendo el esfuerzo de quienes trabajan la tierra y sostienen a sus familias con dignidad. Aprend√≠ que el poder s√≥lo tiene sentido si sirve para cuidar y abrir camino a quienes nunca han sido escuchados.</p>
        <p class="muted" style="margin-top:10px"><strong>Amor y Rabia</strong>: amor por nuestra gente, su trabajo y sus sue√±os; rabia frente a los abusos de siempre. Lucho para que el Estado llegue de verdad a cada comunidad, con respeto y soluciones concretas.</p>
        <p class="muted" style="margin-top:10px">No prometo milagros: prometo presencia, valent√≠a y resultados. Te invito a construirlo juntos/as.</p>
      </div>
      <div class="card" style="padding:0;overflow:hidden">
        <img src="https://www.diarioelheraldo.cl/imagenes/haa1424e0605319878c7a.jpg" alt="Retrato de Consuelo Veloso (Diario El Heraldo)" loading="lazy">
      </div>
    </div>
  </section>

  <!-- PILARES -->
  <section class="section" aria-labelledby="pillars-title">
    <div class="container">
      <h2 id="pillars-title" class="h2">¬øEn qu√© creemos?</h2>
      <div class="grid grid-3" style="margin-top:12px">
        <article class="card pillar">
          <div style="display:flex;align-items:center;gap:8px">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M3 10v4a2 2 0 002 2h1l1.5 3h2l-1.5-3H14a5 5 0 005-5V6l-4 2H5a2 2 0 00-2 2z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
            <h3 style="margin:6px 0 0;font-size:16px">LA VOZ INCONDICIONAL</h3>
          </div>
          <p class="muted" style="margin-top:8px">Siempre del lado de la gente, sin transar. Escuchar de verdad y llevar tu voz a cada espacio de decisi√≥n.</p>
        </article>
        <article class="card pillar">
          <div style="display:flex;align-items:center;gap:8px">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M12 21V7m0 0c0-2.761 2.239-5 5-5h3c0 4.418-3.582 8-8 8m0-3C9.239 7 7 4.761 7 2H4c0 4.418 3.582 8 8 8" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
            <h3 style="margin:6px 0 0;font-size:16px">DIGNIDAD PARA NUESTRA TIERRA</h3>
          </div>
          <p class="muted" style="margin-top:8px">Agua, salud, conectividad y apoyo a quienes producen. Cuidar el Maule Sur es cuidar a nuestra gente.</p>
        </article>
        <article class="card pillar">
          <div style="display:flex;align-items:center;gap:8px">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M12 3l7 3v6c0 4.418-2.239 6.627-7 9-4.761-2.373-7-4.582-7-9V6l7-3z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
            <h3 style="margin:6px 0 0;font-size:16px">VALENT√çA CONTRA LOS PODEROSOS</h3>
          </div>
          <p class="muted" style="margin-top:8px">Fiscalizaci√≥n sin miedo, transparencia total y que los abusos paguen. Lo correcto, aunque cueste.</p>
        </article>
      </div>
    </div>
  </section>

  <!-- VIDEOS -->
  <section id="videos" class="section" aria-labelledby="videos-title">
    <div class="container">
      <h2 id="videos-title" class="h2">Videos</h2>
      <p class="muted">Mira 3 videos recientes de Consuelo.</p>
      <div class="grid grid-3" style="margin-top:12px">
        <div>
          <a class="video-thumb" href="https://www.youtube.com/watch?v=K6nWIc7-0nI" target="_blank" rel="noopener noreferrer">
            <img src="https://img.youtube.com/vi/K6nWIc7-0nI/hqdefault.jpg" alt="S√∫mate con el +56 ‚Äî invitaci√≥n a participar" loading="lazy">
            <div class="play">‚ñ∂</div>
          </a>
          <div class="caption">S√∫mate con el +56 ‚Äî invitaci√≥n a participar</div>
        </div>
        <div>
          <a class="video-thumb" href="https://www.youtube.com/watch?v=OfnFPXZar78" target="_blank" rel="noopener noreferrer">
            <img src="https://img.youtube.com/vi/OfnFPXZar78/hqdefault.jpg" alt="Intervenci√≥n en Sala: cr√≠ticas a la UDI (Caso Hermosilla)" loading="lazy">
            <div class="play">‚ñ∂</div>
          </a>
          <div class="caption">Intervenci√≥n en Sala: cr√≠ticas a la UDI (Caso Hermosilla)</div>
        </div>
        <div>
          <a class="video-thumb" href="https://www.youtube.com/watch?v=6P4RvrZJ4IM" target="_blank" rel="noopener noreferrer">
            <img src="https://img.youtube.com/vi/6P4RvrZJ4IM/hqdefault.jpg" alt="Royalty Minero despachado a ley ‚Äî Veloso celebra y destaca fondos regionales" loading="lazy">
            <div class="play">‚ñ∂</div>
          </a>
          <div class="caption">Royalty Minero despachado a ley ‚Äî Veloso celebra y destaca fondos regionales</div>
        </div>
      </div>
    </div>
  </section>

  <!-- FORMULARIO -->
  <section id="sumate" class="section" aria-labelledby="join-title">
    <div class="container grid grid-2">
      <div>
        <h2 id="join-title" class="h2">S√∫mate</h2>
        <p class="muted">Completa el formulario: pedimos lo m√≠nimo indispensable para organizar equipos por comuna.</p>
        <ul class="muted">
          <li>Nombre y contacto</li>
          <li>Comuna (incluye Digital / Otra)</li>
          <li>Checkbox de voluntariado</li>
        </ul>
      </div>

      <form id="vol-form" class="card form" action="https://script.google.com/macros/s/AKfycbwudH-46D_b6DCCsvp1APOb3-9I6pF7zN82e4D3QNkQlFI9b30hkTrdQhkLZ_LTJm_hbA/exec" method="POST">
        <div class="row row-2">
          <div>
            <label>Nombre
              <input class="input" type="text" name="nombre" required>
            </label>
          </div>
          <div>
            <label>Correo
              <input class="input" type="email" name="email" required>
            </label>
          </div>
        </div>

        <div class="row row-2">
          <div>
            <label>Tel√©fono (WhatsApp)
              <input class="input" type="tel" name="telefono" placeholder="+56 9 1234 5678" required>
            </label>
          </div>
          <div>
            <label>Comuna
              <select class="select" name="comuna" id="comuna_sel" required>
                <option value="" disabled selected>Selecciona tu comuna</option>
                <option>Cauquenes</option><option>Chanco</option><option>Colb√∫n</option><option>Linares</option>
                <option>Longav√≠</option><option>Parral</option><option>Retiro</option><option>San Javier</option>
                <option>Villa Alegre</option><option>Yerbas Buenas</option>
                <option>Digital</option>
                <option>Otra</option>
              </select>
            </label>
          </div>
        </div>

        <!-- Si eliges "Otra", aparece este campo -->
        <label id="comuna_otra_wrap" style="display:none;margin-top:8px">
          Especifica tu comuna
          <input class="input" type="text" name="comuna_otra" id="comuna_otra" placeholder="Escribe tu comuna">
        </label>

        <!-- hidden meta -->
        <input type="hidden" name="_subject" value="Nuevo registro de voluntariado">
        <input type="hidden" name="_next"    value="https://veloso56.cl/gracias.html">

        <!-- Honeypot -->
        <input type="text" name="apellido" autocomplete="off" tabindex="-1" style="display:none">

        <!-- UTM + referrer + origen + tiempos -->
        <input type="hidden" name="utm_source"   id="utm_source">
        <input type="hidden" name="utm_medium"   id="utm_medium">
        <input type="hidden" name="utm_campaign" id="utm_campaign">
        <input type="hidden" name="utm_content"  id="utm_content">
        <input type="hidden" name="utm_term"     id="utm_term">
        <input type="hidden" name="referrer"     id="referrer">
        <input type="hidden" name="origin"       id="origin">
        <input type="hidden" name="ts_load"      id="ts_load">
        <input type="hidden" name="ts_submit"    id="ts_submit">

        <label style="display:flex;gap:8px;align-items:center;margin-top:8px">
          <input class="checkbox" type="checkbox" name="voluntario" value="S√≠" checked> Quiero ser voluntario/a
        </label>

        <p class="muted" style="font-size:12px">Al enviar aceptas ser contactad@ por el equipo de campa√±a.</p>
        <button class="btn primary" type="submit">Enviar ‚Üí</button>
      </form>
    </div>
  </section>
</main>

<footer class="footer" role="contentinfo">
  <div class="container" style="display:grid;gap:16px">
    <div style="display:flex;flex-wrap:wrap;gap:12px;align-items:center">
      <strong>S√≠gueme</strong>
      <a href="https://www.instagram.com/consuelovelosodiputada/" target="_blank" rel="noopener noreferrer">Instagram</a>
      <a href="https://web.facebook.com/ConsueloVelosoAvila" target="_blank" rel="noopener noreferrer">Facebook</a>
      <a href="https://www.tiktok.com/@consuelovelosoavila" target="_blank" rel="noopener noreferrer">TikTok</a>
      <a href="https://www.youtube.com/@diputadaconsueloveloso" target="_blank" rel="noopener noreferrer">YouTube</a>
      <a href="https://x.com/velosodiputada" target="_blank" rel="noopener noreferrer">X (Twitter)</a>
      <a href="https://chat.whatsapp.com/LDShAeDdPcbHXeD8Y8cQFF" target="_blank" rel="noopener noreferrer">WhatsApp</a>
    </div>
    <div class="legal">
      Campa√±a 2025 ‚Ä¢ Sitio con certificado SSL y protecci√≥n de datos.
    </div>
  </div>
</footer>

<script src="script.js"></script>
<noscript>Este sitio funciona sin JavaScript. Activa JS solo si vas a usar p√≠xeles o anal√≠ticas.</noscript>

<!-- Env√≠o a Apps Script + UTM/referrer + anti-spam (modo no-cors) -->
<script>
(function(){
  const q=new URLSearchParams(location.search);
  ["utm_source","utm_medium","utm_campaign","utm_content","utm_term"].forEach(k=>{
    const el=document.getElementById(k); if(el) el.value=q.get(k)||"";
  });
  const r=document.getElementById("referrer"); if(r) r.value=document.referrer||"direct";
  const o=document.getElementById("origin");   if(o) o.value=location.origin;
  const tl=document.getElementById("ts_load"); if(tl) tl.value=Date.now().toString();

  // Toggle "Otra" en comuna
  const comunaSel = document.getElementById('comuna_sel');
  const wrapOtra  = document.getElementById('comuna_otra_wrap');
  const inputOtra = document.getElementById('comuna_otra');
  function syncOtra(){
    const isOtra = comunaSel?.value === 'Otra';
    if (wrapOtra) wrapOtra.style.display = isOtra ? 'block' : 'none';
    if (inputOtra){
      if (isOtra){ inputOtra.setAttribute('required','required'); }
      else { inputOtra.removeAttribute('required'); inputOtra.value=''; }
    }
  }
  comunaSel?.addEventListener('change', syncOtra);
  syncOtra();

  const form=document.getElementById("vol-form");
  if(!form) return;

  form.addEventListener("submit", async (e)=>{
    e.preventDefault();

    // Anti-spam: honeypot + tiempo m√≠nimo
    const hp=form.querySelector('input[name="apellido"]');
    if(hp && hp.value.trim()!==""){ return; }
    const tsLoad=parseInt(document.getElementById("ts_load")?.value||"0",10);
    const now=Date.now();
    const tsSubmit=document.getElementById("ts_submit"); if(tsSubmit) tsSubmit.value=now.toString();
    if(now - tsLoad < 4000){ alert("Por favor confirma los datos y vuelve a enviar."); return; }

    const btn=form.querySelector('button[type="submit"]');
    if(btn){ btn.disabled=true; btn.textContent="Enviando..."; }

    const next=form.querySelector('input[name="_next"]')?.value || "/gracias.html";

    try {
      await fetch(form.getAttribute("action"), {
        method: "POST",
        body: new FormData(form),
        mode: "no-cors"
      });
    } catch (_) {
      /* Aunque falle la lectura de respuesta, el POST ya habr√° salido. */
    } finally {
      // Dispara conversi√≥n (Meta + GA) en el submit, como respaldo al /gracias.html
      try { fbq && fbq('track','Lead', {content_name:'lead_voluntario'}); } catch(e){}
      try { gtag && gtag('event','lead_voluntario'); } catch(e){}
      // Peque√±a pausa opcional para asegurar salida de beacons
      await new Promise(r=>setTimeout(r,120));
      location.href = next;
    }
  });
})();
</script

<!-- Tarjeta 9:16 para compartir (oculta) -->
<div id="share-card" aria-hidden="true" style="
  position:fixed; left:-9999px; top:-9999px;
  width:1080px; height:1920px;
  display:flex; flex-direction:column; justify-content:space-between;
  background:#0f172a; color:#fff; padding:80px; box-sizing:border-box;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,'Helvetica Neue',Arial">
  <header>
    <div style="font-size:64px;font-weight:800;line-height:1.1;margin:0">Encuesta</div>
    <div id="share-question" style="margin-top:6px;font-size:36px;opacity:.9"></div>
  </header>

  <div id="share-results" style="display:flex;flex-direction:column;gap:18px;font-size:40px"></div>

  <footer style="display:flex;justify-content:space-between;align-items:flex-end">
    <div>
      <div style="font-size:32px;opacity:.85">Total: <span id="share-total">0</span> votos</div>
      <div style="font-size:28px;opacity:.75">Actualizado: <span id="share-date"></span></div>
    </div>
    <div style="text-align:right">
      <div style="font-size:28px;opacity:.85">Participa en</div>
      <div id="share-host" style="font-size:40px;font-weight:800"></div>
    </div>
  </footer>
</div>

<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js" defer></script>
<script>
  // Conecta el bot√≥n al generador cuando el DOM est√© listo
  window.addEventListener('DOMContentLoaded', function(){
    const btn = document.getElementById('btn-share');
    if (btn) btn.addEventListener('click', shareEncuesta);
  });

  async function shareEncuesta(){
    try{
      // 1) Completa la tarjeta con datos actuales
      document.getElementById('share-question').textContent = (typeof QUESTION !== 'undefined' ? QUESTION : 'Encuesta');
      document.getElementById('share-host').textContent = location.host.replace(/^www\./,'');
      document.getElementById('share-date').textContent = new Date().toLocaleString();
      document.getElementById('share-total').textContent = (document.getElementById('total-votos')?.textContent || '0');

      // Copia las filas actuales del resultado (desde tu UI)
      const dst = document.getElementById('share-results');
      dst.innerHTML = '';
      const rows = document.querySelectorAll('#resultados-barras .resultado-barra');
      rows.forEach(row=>{
        const label = row.querySelector('.resultado-label span')?.textContent || '';
        const pct   = row.querySelector('.resultado-fill')?.textContent || '';
        const line  = document.createElement('div');
        line.textContent = `${pct}  ‚Ä¢  ${label}`;
        dst.appendChild(line);
      });

      // 2) Renderiza a imagen 1080x1920
      const node = document.getElementById('share-card');
      const canvas = await html2canvas(node, {scale: 1, backgroundColor: null});
      const blob = await new Promise(r => canvas.toBlob(r, 'image/png', 0.95));
      const file = new File([blob], 'encuesta.png', {type:'image/png'});

      // 3) Intenta compartir nativo (m√≥vil); si no, descarga el PNG
      const shareData = {
        files: [file],
        text: 'Mira c√≥mo va la encuesta y participa:',
        url: location.href
      };

      if (navigator.canShare && navigator.canShare({files:[file]})) {
        await navigator.share(shareData);
      } else {
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url; a.download = 'encuesta.png';
        document.body.appendChild(a); a.click(); a.remove();
        URL.revokeObjectURL(url);
        alert('Descargamos la imagen 9:16. Sube la imagen como historia y pega este link: ' + location.href);
      }
    }catch(err){
      console.error(err);
      alert('No pudimos generar la imagen. Intenta con un navegador m√≥vil reciente.');
    }
  }
</script>

</body>
</html>
